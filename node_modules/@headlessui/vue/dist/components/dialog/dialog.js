import{computed as g,defineComponent as S,h as v,inject as L,nextTick as Z,onMounted as x,onUnmounted as ee,provide as te,ref as D,watchEffect as W}from"vue";import{render as b,Features as K}from"../../utils/render.js";import{Keys as le}from"../../keyboard.js";import{useId as O}from"../../hooks/use-id.js";import{FocusTrap as P}from"../../components/focus-trap/focus-trap.js";import{useInertOthers as oe}from"../../hooks/use-inert-others.js";import{Portal as N,PortalGroup as ae}from"../portal/portal.js";import{StackMessage as _,useStackProvider as ne}from"../../internal/stack-context.js";import{match as F}from"../../utils/match.js";import{ForcePortalRoot as I}from"../../internal/portal-force-root.js";import{Description as re,useDescriptions as ie}from"../description/description.js";import{dom as U}from"../../utils/dom.js";import{useOpenClosed as ue,State as V}from"../../internal/open-closed.js";import{useOutsideClick as se}from"../../hooks/use-outside-click.js";import{getOwnerDocument as pe}from"../../utils/owner.js";import{useEventListener as de}from"../../hooks/use-event-listener.js";import{Hidden as fe,Features as ce}from"../../internal/hidden.js";var ge=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(ge||{});let M=Symbol("DialogContext");function R(a){let i=L(M,null);if(i===null){let t=new Error(`<${a} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,R),t}return i}let T="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Ae=S({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:T},initialFocus:{type:Object,default:null}},emits:{close:a=>!0},setup(a,{emit:i,attrs:t,slots:u,expose:r}){var A;let d=D(!1);x(()=>{d.value=!0});let n=D(0),p=ue(),h=g(()=>a.open===T&&p!==null?F(p.value,{[V.Open]:!0,[V.Closed]:!1}):a.open),E=D(new Set),f=D(null),B=D(null),k=g(()=>pe(f));if(r({el:f,$el:f}),!(a.open!==T||p!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof h.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${h.value===T?void 0:a.open}`);let c=g(()=>d.value&&h.value?0:1),$=g(()=>c.value===0),C=g(()=>n.value>1),Y=L(M,null)!==null,q=g(()=>C.value?"parent":"leaf");oe(f,g(()=>C.value?$.value:!1)),ne({type:"Dialog",element:f,onUpdate:(o,l,e)=>{if(l==="Dialog")return F(o,{[_.Add](){E.value.add(e),n.value+=1},[_.Remove](){E.value.delete(e),n.value-=1}})}});let G=ie({name:"DialogDescription",slot:g(()=>({open:h.value}))}),z=`headlessui-dialog-${O()}`,w=D(null),y={titleId:w,panelRef:D(null),dialogState:c,setTitleId(o){w.value!==o&&(w.value=o)},close(){i("close",!1)}};return te(M,y),se(()=>{var l,e,m;return[...Array.from((e=(l=k.value)==null?void 0:l.querySelectorAll("body > *, [data-headlessui-portal]"))!=null?e:[]).filter(s=>!(!(s instanceof HTMLElement)||s.contains(U(B))||y.panelRef.value&&s.contains(y.panelRef.value))),(m=y.panelRef.value)!=null?m:f.value]},(o,l)=>{y.close(),Z(()=>l==null?void 0:l.focus())},g(()=>c.value===0&&!C.value)),de((A=k.value)==null?void 0:A.defaultView,"keydown",o=>{o.defaultPrevented||o.key===le.Escape&&c.value===0&&(C.value||(o.preventDefault(),o.stopPropagation(),y.close()))}),W(o=>{var j;if(c.value!==0||Y)return;let l=k.value;if(!l)return;let e=l==null?void 0:l.documentElement,m=(j=l.defaultView)!=null?j:window,s=e.style.overflow,J=e.style.paddingRight,H=m.innerWidth-e.clientWidth;if(e.style.overflow="hidden",H>0){let Q=e.clientWidth-e.offsetWidth,X=H-Q;e.style.paddingRight=`${X}px`}o(()=>{e.style.overflow=s,e.style.paddingRight=J})}),W(o=>{if(c.value!==0)return;let l=U(f);if(!l)return;let e=new IntersectionObserver(m=>{for(let s of m)s.boundingClientRect.x===0&&s.boundingClientRect.y===0&&s.boundingClientRect.width===0&&s.boundingClientRect.height===0&&y.close()});e.observe(l),o(()=>e.disconnect())}),()=>{let o={...t,ref:f,id:z,role:"dialog","aria-modal":c.value===0?!0:void 0,"aria-labelledby":w.value,"aria-describedby":G.value},{open:l,initialFocus:e,...m}=a,s={open:c.value===0};return v(I,{force:!0},()=>[v(N,()=>v(ae,{target:f.value},()=>v(I,{force:!1},()=>v(P,{initialFocus:e,containers:E,features:$.value?F(q.value,{parent:P.features.RestoreFocus,leaf:P.features.All&~P.features.FocusLock}):P.features.None},()=>b({props:{...m,...o},slot:s,attrs:t,slots:u,visible:c.value===0,features:K.RenderStrategy|K.Static,name:"Dialog"}))))),v(fe,{features:ce.Hidden,ref:B})])}}}),He=S({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:i,slots:t}){let u=R("DialogOverlay"),r=`headlessui-dialog-overlay-${O()}`;function d(n){n.target===n.currentTarget&&(n.preventDefault(),n.stopPropagation(),u.close())}return()=>b({props:{...a,...{id:r,"aria-hidden":!0,onClick:d}},slot:{open:u.dialogState.value===0},attrs:i,slots:t,name:"DialogOverlay"})}}),je=S({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"}},inheritAttrs:!1,setup(a,{attrs:i,slots:t,expose:u}){let r=R("DialogBackdrop"),d=`headlessui-dialog-backdrop-${O()}`,n=D(null);return u({el:n,$el:n}),x(()=>{if(r.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let p=a,h={id:d,ref:n,"aria-hidden":!0};return v(I,{force:!0},()=>v(N,()=>b({props:{...i,...p,...h},slot:{open:r.dialogState.value===0},attrs:i,slots:t,name:"DialogBackdrop"})))}}}),Le=S({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:i,slots:t,expose:u}){let r=R("DialogPanel"),d=`headlessui-dialog-panel-${O()}`;u({el:r.panelRef,$el:r.panelRef});function n(p){p.stopPropagation()}return()=>{let p={id:d,ref:r.panelRef,onClick:n};return b({props:{...a,...p},slot:{open:r.dialogState.value===0},attrs:i,slots:t,name:"DialogPanel"})}}}),We=S({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"}},setup(a,{attrs:i,slots:t}){let u=R("DialogTitle"),r=`headlessui-dialog-title-${O()}`;return x(()=>{u.setTitleId(r),ee(()=>u.setTitleId(null))}),()=>b({props:{...a,...{id:r}},slot:{open:u.dialogState.value===0},attrs:i,slots:t,name:"DialogTitle"})}}),Ke=re;export{Ae as Dialog,je as DialogBackdrop,Ke as DialogDescription,He as DialogOverlay,Le as DialogPanel,We as DialogTitle};
